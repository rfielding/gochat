<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <site_title>Chat Forms</site_title>
    <base_url>http://localhost:8080</base_url>
    
    <templates>
        <template name="home_page">
            <![CDATA[
                <!DOCTYPE html>
                <html>
                <head>
                    <title>{{.SiteTitle}}</title>
                    <style>
                        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
                        .qr-code { margin: 20px 0; text-align: center; }
                        .qr-code a { display: block; margin: 10px 0; }
                    </style>
                </head>
                <body>
                    <h1>{{.SiteTitle}}</h1>
                    <div class="qr-code">
                        <h2>Registration Form</h2>
                        <img src="/qr/registration" alt="Registration QR Code">
                        <a href="/form/registration">Click here to open registration form</a>
                    </div>
                </body>
                </html>
            ]]>
        </template>

        <template name="chat_form">
            <![CDATA[
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Chat Form</title>
                    <style>
                        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
                        #chat-container { height: 400px; border: 1px solid #ccc; margin: 20px 0; padding: 10px; overflow-y: auto; }
                        #user-input { width: 80%; padding: 10px; }
                        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
                    </style>
                </head>
                <body>
                    <div id="chat-container"></div>
                    <div>
                        <input type="text" id="user-input" placeholder="Type your response...">
                        <button onclick="sendMessage()">Send</button>
                    </div>
                    <script>
                        function appendMessage(text, isUser) {
                            const div = document.createElement('div');
                            div.style.margin = '10px 0';
                            div.style.padding = '10px';
                            div.style.backgroundColor = isUser ? '#007bff' : '#f0f0f0';
                            div.style.color = isUser ? 'white' : 'black';
                            div.textContent = text;
                            document.getElementById('chat-container').appendChild(div);
                            div.scrollIntoView();
                        }

                        function sendMessage() {
                            const input = document.getElementById('user-input');
                            const message = input.value.trim();
                            if (message) {
                                appendMessage(message, true);
                                fetch(window.location.pathname + '/chat', {
                                    method: 'POST',
                                    headers: {'Content-Type': 'application/json'},
                                    body: JSON.stringify({message: message})
                                })
                                .then(response => response.json())
                                .then(data => {
                                    appendMessage(data.response, false);
                                    input.value = '';
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    appendMessage('Sorry, there was an error processing your message.', false);
                                });
                            }
                        }

                        document.getElementById('user-input').addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                sendMessage();
                            }
                        });

                        // Start the conversation
                        fetch(window.location.pathname + '/chat', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({message: 'start'})
                        })
                        .then(response => response.json())
                        .then(data => appendMessage(data.response, false))
                        .catch(error => {
                            console.error('Error:', error);
                            appendMessage('Sorry, there was an error starting the chat.', false);
                        });
                    </script>
                </body>
                </html>
            ]]>
        </template>
    </templates>

    <forms>
        <form name="registration">
            <config>
                {
                    "path": "/register",
                    "title": "Registration Form",
                    "description": "Please complete your registration",
                    "button_text": "Send"
                }
            </config>
            <form_fields>
                Full Name: {{.FullName}}
                Date of Birth: {{.DateOfBirth}}
                License Number: {{.License}}
                Contact Information: {{.Contact}}
            </form_fields>
            <system_prompt>
                You are a friendly form assistant. Help users fill out this form:
                %s
                
                Ask for each piece of information one at a time.
                When all information is collected, show a summary and ask for confirmation.
                After confirmation, say EXACTLY: "We are saving this form in our database."
            </system_prompt>
        </form>
    </forms>
</configuration> 